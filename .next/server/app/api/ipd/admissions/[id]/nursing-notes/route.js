(()=>{var e={};e.id=673,e.ids=[673],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33159:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47436:(e,s,t)=>{"use strict";t.r(s),t.d(s,{patchFetch:()=>_,routeModule:()=>p,serverHooks:()=>m,workAsyncStorage:()=>c,workUnitAsyncStorage:()=>l});var r={};t.r(r),t.d(r,{GET:()=>u,POST:()=>d});var n=t(2179),o=t(20540),i=t(57395),a=t(8306);async function u(e,{params:s}){try{let e=await Object(function(){var e=Error("Cannot find module '@/lib/session'");throw e.code="MODULE_NOT_FOUND",e}())();if(!e||!e.user)return a.NextResponse.json({error:"Unauthorized"},{status:401});let{id:t}=await s,r=await Object(function(){var e=Error("Cannot find module '@/lib/database'");throw e.code="MODULE_NOT_FOUND",e}())(),n=await r.query(`
      SELECT a.*, p.first_name as patient_first_name, p.last_name as patient_last_name;
      FROM admissions a;
      JOIN patients p ON a.patient_id = p.id;
      WHERE a.id = ?
    `,[t]),o=n.results&&n.results.length>0?n.results[0]:void 0;if(!o)return a.NextResponse.json({error:"Admission not found"},{status:404});let i="Nurse"===e.user.roleName,u="Doctor"===e.user.roleName,d="Admin"===e.user.roleName,p=e.user.permissions?.includes("nursing_notes:view")??!1;if(!i&&!u&&!d&&!p)return a.NextResponse.json({error:"Forbidden"},{status:403});let c=await r.query(`
      SELECT nn.*, u.first_name as nurse_first_name, u.last_name as nurse_last_name;
      FROM nursing_notes nn;
      JOIN users u ON nn.nurse_id = u.id;
      WHERE nn.admission_id = ?
      ORDER BY nn.note_date DESC;
    `,[t]);return a.NextResponse.json({admission:o,nursing_notes:c.results||[]})}catch(s){console.error("Error fetching nursing notes:",s);let e=s instanceof Error?s.message:String(s);return a.NextResponse.json({error:"Failed to fetch nursing notes",details:e},{status:500})}}async function d(e,{params:s}){try{let t=await Object(function(){var e=Error("Cannot find module '@/lib/session'");throw e.code="MODULE_NOT_FOUND",e}())();if(!t||!t.user)return a.NextResponse.json({error:"Unauthorized"},{status:401});let r="Nurse"===t.user.roleName,n=t.user.permissions?.includes("nursing_notes:create")??!1;if(!r&&!n)return a.NextResponse.json({error:"Forbidden"},{status:403});let{id:o}=await s,i=await e.json();if(!i.notes)return a.NextResponse.json({error:"Missing required field: notes"},{status:400});let u=await Object(function(){var e=Error("Cannot find module '@/lib/database'");throw e.code="MODULE_NOT_FOUND",e}())(),d=await u.query("SELECT id, status FROM admissions WHERE id = ?",[o]),p=d.results&&d.results.length>0?d.results[0]:void 0;if(!p)return a.NextResponse.json({error:"Admission not found"},{status:404});if("active"!==p.status)return a.NextResponse.json({error:"Cannot add nursing notes to a non-active admission"},{status:409});return await u.query(`
      INSERT INTO nursing_notes (
        admission_id, nurse_id, note_date, vital_signs, intake_output, medication_given, procedures, notes;
      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?)
    `,[o,t.user.userId,i.note_date||new Date().toISOString(),i.vital_signs||void 0,i.intake_output||void 0,i.medication_given||void 0,i.procedures||void 0,i.notes]),a.NextResponse.json({message:"Nursing note created (mock operation)"},{status:201})}catch(s){console.error("Error creating nursing note:",s);let e=s instanceof Error?s.message:String(s);return a.NextResponse.json({error:"Failed to create nursing note",details:e},{status:500})}}!function(){var e=Error("Cannot find module '@/lib/database'");throw e.code="MODULE_NOT_FOUND",e}(),function(){var e=Error("Cannot find module '@/lib/session'");throw e.code="MODULE_NOT_FOUND",e}();let p=new n.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/ipd/admissions/[id]/nursing-notes/route",pathname:"/api/ipd/admissions/[id]/nursing-notes",filename:"route",bundlePath:"app/api/ipd/admissions/[id]/nursing-notes/route"},resolvedPagePath:"/workspace/Hospital-Management-System/src/app/api/ipd/admissions/[id]/nursing-notes/route.ts",nextConfigOutput:"",userland:r}),{workAsyncStorage:c,workUnitAsyncStorage:l,serverHooks:m}=p;function _(){return(0,i.patchFetch)({workAsyncStorage:c,workUnitAsyncStorage:l})}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73327:()=>{}};var s=require("../../../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[7395,6088],()=>t(47436));module.exports=r})();
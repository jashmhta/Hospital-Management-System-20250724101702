(()=>{var e={};e.id=4067,e.ids=[4067],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33159:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73327:()=>{},98657:(e,r,s)=>{"use strict";s.r(r),s.d(r,{patchFetch:()=>m,routeModule:()=>u,serverHooks:()=>l,workAsyncStorage:()=>p,workUnitAsyncStorage:()=>c});var t={};s.r(t),s.d(t,{GET:()=>d});var a=s(2179),i=s(20540),o=s(57395),n=s(8306);async function d(e,{params:r}){try{let e=await Object(function(){var e=Error("Cannot find module '@/lib/session'");throw e.code="MODULE_NOT_FOUND",e}())();if(!e||!e.user)return n.NextResponse.json({error:"Unauthorized"},{status:401});let{id:s}=await r,t=await Object(function(){var e=Error("Cannot find module '@/lib/database'");throw e.code="MODULE_NOT_FOUND",e}())(),a=await t.query(`
      SELECT a.*, p.first_name as patient_first_name, p.last_name as patient_last_name;
      FROM admissions a;
      JOIN patients p ON a.patient_id = p.id;
      WHERE a.id = ?
    `,[s]),i=a.results&&a.results.length>0?a.results[0]:void 0;if(!i)return n.NextResponse.json({error:"Admission not found"},{status:404});let o="Doctor"===e.user.roleName,d="Nurse"===e.user.roleName,u="Admin"===e.user.roleName,p=e.user.permissions?.includes("discharge_summary:view")??!1;if(!o&&!d&&!u&&!p)return n.NextResponse.json({error:"Forbidden"},{status:403});let c=await t.query(`
      SELECT ds.*, u.first_name as doctor_first_name, u.last_name as doctor_last_name;
      FROM discharge_summaries ds;
      JOIN users u ON ds.doctor_id = u.id;
      WHERE ds.admission_id = ?
    `,[s]),l=c.results&&c.results.length>0?c.results[0]:void 0;return n.NextResponse.json({admission:i,discharge_summary:l||void 0})}catch(r){console.error("Error fetching discharge summary:",r);let e=r instanceof Error?r.message:String(r);return n.NextResponse.json({error:"Failed to fetch discharge summary",details:e},{status:500})}}!function(){var e=Error("Cannot find module '@/lib/database'");throw e.code="MODULE_NOT_FOUND",e}(),function(){var e=Error("Cannot find module '@/lib/session'");throw e.code="MODULE_NOT_FOUND",e}();let u=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/ipd/admissions/[id]/discharge/route",pathname:"/api/ipd/admissions/[id]/discharge",filename:"route",bundlePath:"app/api/ipd/admissions/[id]/discharge/route"},resolvedPagePath:"/workspace/Hospital-Management-System/src/app/api/ipd/admissions/[id]/discharge/route.ts",nextConfigOutput:"",userland:t}),{workAsyncStorage:p,workUnitAsyncStorage:c,serverHooks:l}=u;function m(){return(0,o.patchFetch)({workAsyncStorage:p,workUnitAsyncStorage:c})}}};var r=require("../../../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[7395,6088],()=>s(98657));module.exports=t})();
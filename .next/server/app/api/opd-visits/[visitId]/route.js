(()=>{var e={};e.id=7611,e.ids=[7611],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},32818:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>w,routeModule:()=>v,serverHooks:()=>y,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>N});var n={};r.r(n),r.d(n,{GET:()=>_,PUT:()=>O});var s=r(2179),i=r(20540),o=r(57395),a=r(26064),d=r(24739),p=r(72482);!function(){var e=Error("Cannot find module '@opennextjs/cloudflare'");throw e.code="MODULE_NOT_FOUND",e}(),function(){var e=Error("Cannot find module '@/lib/session'");throw e.code="MODULE_NOT_FOUND",e}(),function(){var e=Error("Cannot find module '@/types/opd'");throw e.code="MODULE_NOT_FOUND",e}();let u=["Admin","Receptionist","Doctor","Nurse"],c=["Admin","Receptionist","Doctor","Nurse"];function l(e){let t=e.split("/"),r=parseInt(t[t.length-1],10);return isNaN(r)?null:r}async function _(e){let t=await (0,a.Nd)(await (0,d.cookies)(),Object(function(){var e=Error("Cannot find module '@/lib/session'");throw e.code="MODULE_NOT_FOUND",e}())),r=l(new URL(e.url).pathname);if(!t.user||!u.includes(t.user.roleName))return new Response(JSON.stringify({error:"Unauthorized"}),{status:401,headers:{"Content-Type":"application/json"}});if(null===r)return new Response(JSON.stringify({error:"Invalid Visit ID"}),{status:400,headers:{"Content-Type":"application/json"}});try{let{env:e}=await Object(function(){var e=Error("Cannot find module '@opennextjs/cloudflare'");throw e.code="MODULE_NOT_FOUND",e}())(),{DB:t}=e,n=await t.prepare(`SELECT 
                ov.*, 
                p.first_name as patient_first_name, p.last_name as patient_last_name,
                u.full_name as doctor_full_name;
             FROM OPDVisits ov;
             JOIN Patients p ON ov.patient_id = p.patient_id;
             JOIN Doctors d ON ov.doctor_id = d.doctor_id;
             JOIN Users u ON d.user_id = u.user_id;
             WHERE ov.opd_visit_id = ?`).bind(r).first();if(!n)return new Response(JSON.stringify({error:"OPD Visit not found"}),{status:404,headers:{"Content-Type":"application/json"}});let s={opd_visit_id:n.opd_visit_id,patient_id:n.patient_id,appointment_id:n.appointment_id,visit_datetime:n.visit_datetime,visit_type:n.visit_type,doctor_id:n.doctor_id,department:n.department,status:n.status,notes:n.notes,created_by_user_id:n.created_by_user_id,created_at:n.created_at,updated_at:n.updated_at,patient:{patient_id:n.patient_id,first_name:n.patient_first_name,last_name:n.patient_last_name},doctor:{doctor_id:n.doctor_id,user:{fullName:n.doctor_full_name}}};return new Response(JSON.stringify(s),{status:200,headers:{"Content-Type":"application/json"}})}catch(e){return console.error(`Get OPD visit ${r} details error:`,e),new Response(JSON.stringify({error:"Internal Server Error",details:e instanceof Error?e.message:"An unexpected error occurred"}),{status:500,headers:{"Content-Type":"application/json"}})}}let f=p.z.object({status:p.z.nativeEnum(Object(function(){var e=Error("Cannot find module '@/types/opd'");throw e.code="MODULE_NOT_FOUND",e}())).optional(),notes:p.z.string().optional().nullable()});async function O(e){let t=await (0,a.Nd)(await (0,d.cookies)(),Object(function(){var e=Error("Cannot find module '@/lib/session'");throw e.code="MODULE_NOT_FOUND",e}())),r=l(new URL(e.url).pathname);if(!t.user||!c.includes(t.user.roleName))return new Response(JSON.stringify({error:"Unauthorized"}),{status:401,headers:{"Content-Type":"application/json"}});if(null===r)return new Response(JSON.stringify({error:"Invalid Visit ID"}),{status:400,headers:{"Content-Type":"application/json"}});try{let t=await e.json(),n=f.safeParse(t);if(!n.success)return new Response(JSON.stringify({error:"Invalid input",details:n.error.errors}),{status:400,headers:{"Content-Type":"application/json"}});let s=n.data;if(0===Object.keys(s).length)return new Response(JSON.stringify({message:"No update data provided"}),{status:200,headers:{"Content-Type":"application/json"}});let{env:i}=await Object(function(){var e=Error("Cannot find module '@opennextjs/cloudflare'");throw e.code="MODULE_NOT_FOUND",e}())(),{DB:o}=i;if(!await o.prepare("SELECT opd_visit_id FROM OPDVisits WHERE opd_visit_id = ?").bind(r).first())return new Response(JSON.stringify({error:"OPD Visit not found"}),{status:404,headers:{"Content-Type":"application/json"}});let a="UPDATE OPDVisits SET updated_at = CURRENT_TIMESTAMP",d=[];if(Object.entries(s).forEach(([e,t])=>{void 0!==t&&(a+=`, ${e} = ?`,d.push(t))}),a+=" WHERE opd_visit_id = ?",d.push(r),!(await o.prepare(a).bind(...d).run()).success)throw Error("Failed to update OPD visit");return new Response(JSON.stringify({message:"OPD Visit updated successfully"}),{status:200,headers:{"Content-Type":"application/json"}})}catch(e){return console.error(`Update OPD visit ${r} error:`,e),new Response(JSON.stringify({error:"Internal Server Error",details:e instanceof Error?e.message:"An unexpected error occurred"}),{status:500,headers:{"Content-Type":"application/json"}})}}let v=new s.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/opd-visits/[visitId]/route",pathname:"/api/opd-visits/[visitId]",filename:"route",bundlePath:"app/api/opd-visits/[visitId]/route"},resolvedPagePath:"/workspace/Hospital-Management-System/src/app/api/opd-visits/[visitId]/route.ts",nextConfigOutput:"",userland:n}),{workAsyncStorage:m,workUnitAsyncStorage:N,serverHooks:y}=v;function w(){return(0,o.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:N})}},33159:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73327:()=>{},77598:e=>{"use strict";e.exports=require("node:crypto")}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[7395,2482,4388,1295],()=>r(32818));module.exports=n})();
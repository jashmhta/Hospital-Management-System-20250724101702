{
  "id": "migration_2025-01-15T00-00-00_add_performance_indexes",
  "name": "Add Performance Indexes",
  "version": "2025-01-15T00-00-00_add_performance_indexes",
  "up": "-- Add performance indexes to critical tables\n\n-- Patient search optimization\nCREATE INDEX CONCURRENTLY IF NOT EXISTS idx_patients_name_search \nON patients USING gin(to_tsvector('english', first_name || ' ' || last_name));\n\nCREATE INDEX CONCURRENTLY IF NOT EXISTS idx_patients_phone_search \nON patients (phone) WHERE phone IS NOT NULL;\n\nCREATE INDEX CONCURRENTLY IF NOT EXISTS idx_patients_email_search \nON patients (email) WHERE email IS NOT NULL;\n\n-- Bill performance indexes\nCREATE INDEX CONCURRENTLY IF NOT EXISTS idx_bills_patient_status \nON bills (patient_id, status);\n\nCREATE INDEX CONCURRENTLY IF NOT EXISTS idx_bills_date_status \nON bills (bill_date, status);\n\nCREATE INDEX CONCURRENTLY IF NOT EXISTS idx_bills_outstanding \nON bills (outstanding_amount) WHERE outstanding_amount > 0;\n\n-- Appointment scheduling optimization\nCREATE INDEX CONCURRENTLY IF NOT EXISTS idx_appointments_doctor_date \nON appointments (doctor_id, appointment_date);\n\nCREATE INDEX CONCURRENTLY IF NOT EXISTS idx_appointments_time_slot \nON appointments (start_time, end_time);\n\n-- Lab order processing optimization\nCREATE INDEX CONCURRENTLY IF NOT EXISTS idx_lab_orders_status_priority \nON lab_orders (status, priority);\n\nCREATE INDEX CONCURRENTLY IF NOT EXISTS idx_lab_results_flag_date \nON lab_results (flag, reported_date) WHERE flag IN ('CRITICAL_HIGH', 'CRITICAL_LOW');\n\n-- IPD management optimization\nCREATE INDEX CONCURRENTLY IF NOT EXISTS idx_admissions_ward_status \nON admissions (ward_id, status);\n\nCREATE INDEX CONCURRENTLY IF NOT EXISTS idx_vital_signs_admission_date \nON vital_signs (admission_id, recorded_at);\n\n-- Insurance claim processing\nCREATE INDEX CONCURRENTLY IF NOT EXISTS idx_insurance_claims_policy_status \nON insurance_claims (insurance_policy_id, status);\n\n-- Audit log performance\nCREATE INDEX CONCURRENTLY IF NOT EXISTS idx_audit_logs_user_timestamp \nON audit_logs (user_id, timestamp);\n\nCREATE INDEX CONCURRENTLY IF NOT EXISTS idx_audit_logs_resource_timestamp \nON audit_logs (resource, timestamp);\n\n-- Session management\nCREATE INDEX CONCURRENTLY IF NOT EXISTS idx_user_sessions_expires_active \nON user_sessions (expires_at, is_active);\n\n-- Radiology workflow\nCREATE INDEX CONCURRENTLY IF NOT EXISTS idx_radiology_studies_date_modality \nON radiology_studies (study_date, modality);\n\n-- Prescription management\nCREATE INDEX CONCURRENTLY IF NOT EXISTS idx_prescriptions_patient_status \nON prescriptions (patient_id, status);",
  "down": "-- Remove performance indexes\n\nDROP INDEX CONCURRENTLY IF EXISTS idx_patients_name_search;\nDROP INDEX CONCURRENTLY IF EXISTS idx_patients_phone_search;\nDROP INDEX CONCURRENTLY IF EXISTS idx_patients_email_search;\nDROP INDEX CONCURRENTLY IF EXISTS idx_bills_patient_status;\nDROP INDEX CONCURRENTLY IF EXISTS idx_bills_date_status;\nDROP INDEX CONCURRENTLY IF EXISTS idx_bills_outstanding;\nDROP INDEX CONCURRENTLY IF EXISTS idx_appointments_doctor_date;\nDROP INDEX CONCURRENTLY IF EXISTS idx_appointments_time_slot;\nDROP INDEX CONCURRENTLY IF EXISTS idx_lab_orders_status_priority;\nDROP INDEX CONCURRENTLY IF EXISTS idx_lab_results_flag_date;\nDROP INDEX CONCURRENTLY IF EXISTS idx_admissions_ward_status;\nDROP INDEX CONCURRENTLY IF EXISTS idx_vital_signs_admission_date;\nDROP INDEX CONCURRENTLY IF EXISTS idx_insurance_claims_policy_status;\nDROP INDEX CONCURRENTLY IF EXISTS idx_audit_logs_user_timestamp;\nDROP INDEX CONCURRENTLY IF EXISTS idx_audit_logs_resource_timestamp;\nDROP INDEX CONCURRENTLY IF EXISTS idx_user_sessions_expires_active;\nDROP INDEX CONCURRENTLY IF EXISTS idx_radiology_studies_date_modality;\nDROP INDEX CONCURRENTLY IF EXISTS idx_prescriptions_patient_status;",
  "checksum": "a1b2c3d4e5f6",
  "createdAt": "2025-01-15T00:00:00.000Z"
}
